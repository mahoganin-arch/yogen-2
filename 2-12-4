//@version=6
strategy("æ—¥çµŒ225å…ˆç‰© - ã‚·ã‚°ãƒŠãƒ«ãƒ™ãƒ¼ã‚¹ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼ V2.0", overlay=true, 
         initial_capital=5000000, default_qty_value=1, default_qty_type=strategy.fixed,
         pyramiding=1, commission_type=strategy.commission.percent, 
         commission_value=0, slippage=0)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼è¨­å®š
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ã‚·ã‚°ãƒŠãƒ«é¸æŠ
entrySignalType = input.string("Nä¸‹é™½", "ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚·ã‚°ãƒŠãƒ«", 
  options=["Nä¸Šé™½","Nä¸Šé™°","Nä¸‹é™½","Nä¸‹é™°","Nâ—","Nâ—†","Nâ–¼","Nâ†“","Nâ—‹","Nâ—‡","Nâ–²","Nâ†‘","Nâ—†â—†","Nâ—‡â—‡","Nâ—Ã—","Nâ—‹Ã—","Nâ†‘3","Nâ†‘4","Nâ†“3","Nâ†“4",
           "Tä¸Šé™½","Tä¸Šé™°","Tä¸‹é™½","Tä¸‹é™°","Tâ—","Tâ—†","Tâ–¼","Tâ†“","Tâ—‹","Tâ—‡","Tâ–²","Tâ†‘","Tâ—†â—†","Tâ—‡â—‡","Tâ—Ã—","Tâ—‹Ã—","Tâ†‘3","Tâ†‘4","Tâ†“3","Tâ†“4",
           "Sä¸Šé™½","Sä¸Šé™°","Sä¸‹é™½","Sä¸‹é™°","Sâ—","Sâ—†","Sâ–¼","Sâ†“","Sâ—‹","Sâ—‡","Sâ–²","Sâ†‘","Sâ—†â—†","Sâ—‡â—‡","Sâ—Ã—","Sâ—‹Ã—","Sâ†‘3","Sâ†‘4","Sâ†“3","Sâ†“4",
           "Qä¸Šé™½","Qä¸Šé™°","Qä¸‹é™½","Qä¸‹é™°","Qâ—","Qâ—†","Qâ–¼","Qâ†“","Qâ—‹","Qâ—‡","Qâ–²","Qâ†‘","Qâ—†â—†","Qâ—‡â—‡","Qâ—Ã—","Qâ—‹Ã—","Qâ†‘3","Qâ†‘4","Qâ†“3","Qâ†“4"],
  group="ã‚·ã‚°ãƒŠãƒ«è¨­å®š")

// MAé–¢ä¿‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
useMaFilter = input.bool(false, "MAé–¢ä¿‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä½¿ç”¨", group="ã‚·ã‚°ãƒŠãƒ«è¨­å®š")
maFilterPattern = input.string("â‘ å§‹>5>25", "MAé–¢ä¿‚", 
  options=["â‘ å§‹>5>25", "â‘¡å§‹>25>5", "â‘¢5>å§‹>25", "â‘£5>25>å§‹", "â‘¤25>å§‹>5", "â‘¥25>5>å§‹"],
  group="ã‚·ã‚°ãƒŠãƒ«è¨­å®š")
maFilterTiming = input.string("ã‚·ã‚°ãƒŠãƒ«ãƒãƒ¼", "MAé–¢ä¿‚ã®åˆ¤å®šã‚¿ã‚¤ãƒŸãƒ³ã‚°",
  options=["ã‚·ã‚°ãƒŠãƒ«ãƒãƒ¼", "ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒãƒ¼"], 
  group="ã‚·ã‚°ãƒŠãƒ«è¨­å®š")

// ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ–¹æ³•
entryMethod = input.string("æ¬¡ãƒãƒ¼å§‹å€¤", "ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ–¹æ³•",
  options=["æ¬¡ãƒãƒ¼å§‹å€¤", "æŒ‡å€¤A", "æŒ‡å€¤C", "æŒ‡å€¤E", "ãƒ•ã‚£ãƒœãƒŠãƒƒãƒ", "MA1H", "MAD"],
  group="ã‚¨ãƒ³ãƒˆãƒªãƒ¼è¨­å®š")

// æŒ‡å€¤Cç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
rangePercent = input.float(0.3, "ãƒ¬ãƒ³ã‚¸æ¯”ç‡", minval=0.1, maxval=0.9, step=0.1, group="ã‚¨ãƒ³ãƒˆãƒªãƒ¼è¨­å®š")

// æŒ‡å€¤Eç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
atrMultiplier = input.float(0.5, "ATRå€ç‡", minval=0.1, maxval=2.0, step=0.1, group="ã‚¨ãƒ³ãƒˆãƒªãƒ¼è¨­å®š")

// ãƒ•ã‚£ãƒœãƒŠãƒƒãƒç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
fiboLevel = input.string("50%", "ãƒ•ã‚£ãƒœãƒŠãƒƒãƒãƒ¬ãƒ™ãƒ«", 
  options=["38.2%", "50%", "61.8%"], group="ã‚¨ãƒ³ãƒˆãƒªãƒ¼è¨­å®š")

// MAã‚¿ãƒƒãƒç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
maTypeForEntry = input.string("5MA", "MAã‚¿ãƒƒãƒ - MAç¨®é¡", 
  options=["5MA", "25MA"], group="ã‚¨ãƒ³ãƒˆãƒªãƒ¼è¨­å®š")

// ã‚¤ã‚°ã‚¸ãƒƒãƒˆè¨­å®š
exitType = input.string("ç¿Œæ—¥çµ‚å€¤", "ã‚¤ã‚°ã‚¸ãƒƒãƒˆã‚¿ã‚¤ãƒŸãƒ³ã‚°", 
  options=["å½“æ—¥çµ‚å€¤", "ç¿Œæ—¥çµ‚å€¤", "ç¿Œã€…æ—¥çµ‚å€¤"],
  group="ã‚¤ã‚°ã‚¸ãƒƒãƒˆè¨­å®š")

// è¡¨ç¤ºè¨­å®š
showSignals = input.bool(true, "ã‚·ã‚°ãƒŠãƒ«ã‚’è¡¨ç¤º", group="è¡¨ç¤ºè¨­å®š")
showEntryExit = input.bool(true, "ã‚¨ãƒ³ãƒˆãƒªãƒ¼/ã‚¤ã‚°ã‚¸ãƒƒãƒˆã‚’è¡¨ç¤º", group="è¡¨ç¤ºè¨­å®š")
showDailyMA = input.bool(true, "æ—¥è¶³MAã‚’è¡¨ç¤º", group="è¡¨ç¤ºè¨­å®š")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1æ™‚é–“è¶³ã®ç§»å‹•å¹³å‡ç·š
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ma5_1h = ta.sma(close, 5)
ma25_1h = ta.sma(close, 25)

plot(ma5_1h, "5MA(1H)", color=color.new(color.blue, 0), linewidth=1)
plot(ma25_1h, "25MA(1H)", color=color.new(color.red, 0), linewidth=1)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ—¥è¶³ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ—¥è¶³ã®ç§»å‹•å¹³å‡ç·šï¼ˆè¡¨ç¤ºç”¨ï¼‰
ma5_daily = request.security(syminfo.tickerid, "D", ta.sma(close, 5), lookahead=barmerge.lookahead_off)
ma25_daily = request.security(syminfo.tickerid, "D", ta.sma(close, 25), lookahead=barmerge.lookahead_off)

plot(showDailyMA ? ma5_daily : na, "5MA(æ—¥è¶³)", color=color.new(color.aqua, 0), linewidth=2, style=plot.style_line)
plot(showDailyMA ? ma25_daily : na, "25MA(æ—¥è¶³)", color=color.new(color.orange, 0), linewidth=2, style=plot.style_line)

// æ—¥è¶³ã®å„å¸‚å ´ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚·ã‚°ãƒŠãƒ«æ¤œå‡ºç”¨ï¼‰
// æ—¥æœ¬å¸‚å ´: lookahead_off
// ç±³å›½å¸‚å ´: lookahead_on (æ™‚å·®è£œæ­£ã®ãŸã‚)
[nk_open, nk_high, nk_low, nk_close] = request.security("TVC:NI225", "D", [open, high, low, close], lookahead=barmerge.lookahead_off, gaps=barmerge.gaps_off)
[tp_open, tp_high, tp_low, tp_close] = request.security("TSE:TOPIX", "D", [open, high, low, close], lookahead=barmerge.lookahead_off, gaps=barmerge.gaps_off)
[sp_open, sp_high, sp_low, sp_close] = request.security("SP:SPX", "D", [open, high, low, close], lookahead=barmerge.lookahead_on, gaps=barmerge.gaps_off)
[nq_open, nq_high, nq_low, nq_close] = request.security("NASDAQ:NDX", "D", [open, high, low, close], lookahead=barmerge.lookahead_on, gaps=barmerge.gaps_off)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ã‚·ã‚°ãƒŠãƒ«æ¤œå‡ºé–¢æ•°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
f_detectSignals(o, h, l, c, o1, h1, l1, c1, ma5_val) =>
    body = math.abs(c - o)
    upperWick = h - math.max(c, o)
    lowerWick = math.min(c, o) - l
    
    isBullish = c > o
    isBearish = c < o
    prevBullish = c1 > o1
    prevBearish = c1 < o1
    
    bodyTop = isBullish ? c : o
    bodyBottom = isBullish ? o : c
    prevBodyTop = prevBullish ? c1 : o1
    prevBodyBottom = prevBullish ? o1 : c1
    
    // ã‚¹ãƒ‘ã‚¤ã‚¯æ¡ä»¶ï¼ˆé«­ >= å®Ÿä½“ Ã— 3ï¼‰
    spikeHighRaw = upperWick >= body * 3 and body > 0
    spikeLowRaw = lowerWick >= body * 3 and body > 0
    
    // ä¸¡æ–¹æˆç«‹ã™ã‚‹å ´åˆã¯é™¤å¤–
    bothSpikes = spikeHighRaw and spikeLowRaw
    
    // æ–°ã—ã„4ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚¹ãƒ‘ã‚¤ã‚¯ã‚·ã‚°ãƒŠãƒ«ï¼ˆä¸¡æ–¹æˆç«‹æ™‚ã¯é™¤å¤–ï¼‰
    spikeHighBullish = spikeHighRaw and not bothSpikes and isBullish  // ä¸Šé«­ã‚¹ãƒ‘ã‚¤ã‚¯ + é™½ç·š â†’ è²·ã„
    spikeHighBearish = spikeHighRaw and not bothSpikes and isBearish  // ä¸Šé«­ã‚¹ãƒ‘ã‚¤ã‚¯ + é™°ç·š â†’ å£²ã‚Š
    spikeLowBullish = spikeLowRaw and not bothSpikes and isBullish    // ä¸‹é«­ã‚¹ãƒ‘ã‚¤ã‚¯ + é™½ç·š â†’ è²·ã„
    spikeLowBearish = spikeLowRaw and not bothSpikes and isBearish    // ä¸‹é«­ã‚¹ãƒ‘ã‚¤ã‚¯ + é™°ç·š â†’ å£²ã‚Š
    
    bearishHarami = prevBullish and isBearish and bodyTop <= prevBodyTop and bodyBottom >= prevBodyBottom
    bearishEngulfing = prevBullish and isBearish and bodyTop >= prevBodyTop and bodyBottom <= prevBodyBottom
    bullishHarami = prevBearish and isBullish and bodyTop <= prevBodyTop and bodyBottom >= prevBodyBottom
    bullishEngulfing = prevBearish and isBullish and bodyTop >= prevBodyTop and bodyBottom <= prevBodyBottom
    
    bearishBearishHarami = prevBearish and isBearish and bodyTop <= prevBodyTop and bodyBottom >= prevBodyBottom
    bullishBullishHarami = prevBullish and isBullish and bodyTop <= prevBodyTop and bodyBottom >= prevBodyBottom
    
    bearishEngulfingRejected = prevBullish and isBearish and o > c1 and h >= h1 and l <= l1 and not (bodyTop >= prevBodyTop and bodyBottom <= prevBodyBottom)
    bullishEngulfingRejected = prevBearish and isBullish and o < c1 and h >= h1 and l <= l1 and not (bodyTop >= prevBodyTop and bodyBottom <= prevBodyBottom)
    
    longerUpperWick = upperWick > lowerWick
    longerLowerWick = lowerWick > upperWick
    
    wickBelowMa5Rejected = l < ma5_val and c > ma5_val and o > ma5_val
    wickAboveMa5Rejected = h > ma5_val and c < ma5_val and o < ma5_val
    
    [spikeHighBullish, spikeHighBearish, spikeLowBullish, spikeLowBearish,
     bearishEngulfing, bullishEngulfing, bearishHarami, bullishHarami, 
     longerUpperWick, longerLowerWick, wickAboveMa5Rejected, wickBelowMa5Rejected,
     bearishBearishHarami, bullishBullishHarami, bearishEngulfingRejected, bullishEngulfingRejected]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAé–¢ä¿‚åˆ¤å®šé–¢æ•°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
f_getMaPattern(entryOpen, ma5Val, ma25Val) =>
    pattern = ""
    if entryOpen > ma5Val and ma5Val > ma25Val
        pattern := "â‘ å§‹>5>25"
    else if entryOpen > ma25Val and ma25Val > ma5Val
        pattern := "â‘¡å§‹>25>5"
    else if ma5Val > entryOpen and entryOpen > ma25Val
        pattern := "â‘¢5>å§‹>25"
    else if ma5Val > ma25Val and ma25Val > entryOpen
        pattern := "â‘£5>25>å§‹"
    else if ma25Val > entryOpen and entryOpen > ma5Val
        pattern := "â‘¤25>å§‹>5"
    else if ma25Val > ma5Val and ma5Val > entryOpen
        pattern := "â‘¥25>5>å§‹"
    pattern

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ—¥è¶³ã®å„å¸‚å ´ã‚·ã‚°ãƒŠãƒ«æ¤œå‡º
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[nk_spikeHighBull, nk_spikeHighBear, nk_spikeLowBull, nk_spikeLowBear, nk_bearishEng, nk_bullishEng, nk_bearishHar, nk_bullishHar, nk_upperWick, nk_lowerWick, nk_wickAbove, nk_wickBelow, nk_bbHar, nk_bbullHar, nk_bearEngRej, nk_bullEngRej] = f_detectSignals(nk_open, nk_high, nk_low, nk_close, nk_open[1], nk_high[1], nk_low[1], nk_close[1], ta.sma(nk_close, 5))
[tp_spikeHighBull, tp_spikeHighBear, tp_spikeLowBull, tp_spikeLowBear, tp_bearishEng, tp_bullishEng, tp_bearishHar, tp_bullishHar, tp_upperWick, tp_lowerWick, tp_wickAbove, tp_wickBelow, tp_bbHar, tp_bbullHar, tp_bearEngRej, tp_bullEngRej] = f_detectSignals(tp_open, tp_high, tp_low, tp_close, tp_open[1], tp_high[1], tp_low[1], tp_close[1], ta.sma(tp_close, 5))
[sp_spikeHighBull, sp_spikeHighBear, sp_spikeLowBull, sp_spikeLowBear, sp_bearishEng, sp_bullishEng, sp_bearishHar, sp_bullishHar, sp_upperWick, sp_lowerWick, sp_wickAbove, sp_wickBelow, sp_bbHar, sp_bbullHar, sp_bearEngRej, sp_bullEngRej] = f_detectSignals(sp_open, sp_high, sp_low, sp_close, sp_open[1], sp_high[1], sp_low[1], sp_close[1], ta.sma(sp_close, 5))
[nq_spikeHighBull, nq_spikeHighBear, nq_spikeLowBull, nq_spikeLowBear, nq_bearishEng, nq_bullishEng, nq_bearishHar, nq_bullishHar, nq_upperWick, nq_lowerWick, nq_wickAbove, nq_wickBelow, nq_bbHar, nq_bbullHar, nq_bearEngRej, nq_bullEngRej] = f_detectSignals(nq_open, nq_high, nq_low, nq_close, nq_open[1], nq_high[1], nq_low[1], nq_close[1], ta.sma(nq_close, 5))

// é€£ç¶šã‚¦ã‚£ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³
nk_lowerWick4 = nk_lowerWick and nk_lowerWick[1] and nk_lowerWick[2] and nk_lowerWick[3]
nk_lowerWick3 = nk_lowerWick and nk_lowerWick[1] and nk_lowerWick[2] and not nk_lowerWick4
nk_upperWick4 = nk_upperWick and nk_upperWick[1] and nk_upperWick[2] and nk_upperWick[3]
nk_upperWick3 = nk_upperWick and nk_upperWick[1] and nk_upperWick[2] and not nk_upperWick4

tp_lowerWick4 = tp_lowerWick and tp_lowerWick[1] and tp_lowerWick[2] and tp_lowerWick[3]
tp_lowerWick3 = tp_lowerWick and tp_lowerWick[1] and tp_lowerWick[2] and not tp_lowerWick4
tp_upperWick4 = tp_upperWick and tp_upperWick[1] and tp_upperWick[2] and tp_upperWick[3]
tp_upperWick3 = tp_upperWick and tp_upperWick[1] and tp_upperWick[2] and not tp_upperWick4

sp_lowerWick4 = sp_lowerWick and sp_lowerWick[1] and sp_lowerWick[2] and sp_lowerWick[3]
sp_lowerWick3 = sp_lowerWick and sp_lowerWick[1] and sp_lowerWick[2] and not sp_lowerWick4
sp_upperWick4 = sp_upperWick and sp_upperWick[1] and sp_upperWick[2] and sp_upperWick[3]
sp_upperWick3 = sp_upperWick and sp_upperWick[1] and sp_upperWick[2] and not sp_upperWick4

nq_lowerWick4 = nq_lowerWick and nq_lowerWick[1] and nq_lowerWick[2] and nq_lowerWick[3]
nq_lowerWick3 = nq_lowerWick and nq_lowerWick[1] and nq_lowerWick[2] and not nq_lowerWick4
nq_upperWick4 = nq_upperWick and nq_upperWick[1] and nq_upperWick[2] and nq_upperWick[3]
nq_upperWick3 = nq_upperWick and nq_upperWick[1] and nq_upperWick[2] and not nq_upperWick4

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ã‚·ã‚°ãƒŠãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°é–¢æ•°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
f_checkSignal(signalName) =>
    isSignal = false
    isBearishSignal = false
    
    // æ—¥çµŒç¾ç‰© (N)
    if signalName == "Nä¸Šé™½"
        isSignal := nk_spikeHighBull
        isBearishSignal := false
    else if signalName == "Nä¸Šé™°"
        isSignal := nk_spikeHighBear
        isBearishSignal := true
    else if signalName == "Nä¸‹é™½"
        isSignal := nk_spikeLowBull
        isBearishSignal := false
    else if signalName == "Nä¸‹é™°"
        isSignal := nk_spikeLowBear
        isBearishSignal := true
    else if signalName == "Nâ—"
        isSignal := nk_bearishEng
        isBearishSignal := true
    else if signalName == "Nâ—†"
        isSignal := nk_bearishHar
        isBearishSignal := true
    else if signalName == "Nâ–¼"
        isSignal := nk_wickAbove
        isBearishSignal := true
    else if signalName == "Nâ†“"
        isSignal := nk_upperWick
        isBearishSignal := true
    else if signalName == "Nâ—‹"
        isSignal := nk_bullishEng
        isBearishSignal := false
    else if signalName == "Nâ—‡"
        isSignal := nk_bullishHar
        isBearishSignal := false
    else if signalName == "Nâ–²"
        isSignal := nk_wickBelow
        isBearishSignal := false
    else if signalName == "Nâ†‘"
        isSignal := nk_lowerWick
        isBearishSignal := false
    else if signalName == "Nâ—†â—†"
        isSignal := nk_bbHar
        isBearishSignal := false
    else if signalName == "Nâ—‡â—‡"
        isSignal := nk_bbullHar
        isBearishSignal := true
    else if signalName == "Nâ—Ã—"
        isSignal := nk_bearEngRej
        isBearishSignal := false
    else if signalName == "Nâ—‹Ã—"
        isSignal := nk_bullEngRej
        isBearishSignal := true
    else if signalName == "Nâ†‘3"
        isSignal := nk_lowerWick3
        isBearishSignal := false
    else if signalName == "Nâ†‘4"
        isSignal := nk_lowerWick4
        isBearishSignal := false
    else if signalName == "Nâ†“3"
        isSignal := nk_upperWick3
        isBearishSignal := true
    else if signalName == "Nâ†“4"
        isSignal := nk_upperWick4
        isBearishSignal := true
    
    // TOPIX (T)
    else if signalName == "Tä¸Šé™½"
        isSignal := tp_spikeHighBull
        isBearishSignal := false
    else if signalName == "Tä¸Šé™°"
        isSignal := tp_spikeHighBear
        isBearishSignal := true
    else if signalName == "Tä¸‹é™½"
        isSignal := tp_spikeLowBull
        isBearishSignal := false
    else if signalName == "Tä¸‹é™°"
        isSignal := tp_spikeLowBear
        isBearishSignal := true
    else if signalName == "Tâ—"
        isSignal := tp_bearishEng
        isBearishSignal := true
    else if signalName == "Tâ—†"
        isSignal := tp_bearishHar
        isBearishSignal := true
    else if signalName == "Tâ–¼"
        isSignal := tp_wickAbove
        isBearishSignal := true
    else if signalName == "Tâ†“"
        isSignal := tp_upperWick
        isBearishSignal := true
    else if signalName == "Tâ—‹"
        isSignal := tp_bullishEng
        isBearishSignal := false
    else if signalName == "Tâ—‡"
        isSignal := tp_bullishHar
        isBearishSignal := false
    else if signalName == "Tâ–²"
        isSignal := tp_wickBelow
        isBearishSignal := false
    else if signalName == "Tâ†‘"
        isSignal := tp_lowerWick
        isBearishSignal := false
    else if signalName == "Tâ—†â—†"
        isSignal := tp_bbHar
        isBearishSignal := false
    else if signalName == "Tâ—‡â—‡"
        isSignal := tp_bbullHar
        isBearishSignal := true
    else if signalName == "Tâ—Ã—"
        isSignal := tp_bearEngRej
        isBearishSignal := false
    else if signalName == "Tâ—‹Ã—"
        isSignal := tp_bullEngRej
        isBearishSignal := true
    else if signalName == "Tâ†‘3"
        isSignal := tp_lowerWick3
        isBearishSignal := false
    else if signalName == "Tâ†‘4"
        isSignal := tp_lowerWick4
        isBearishSignal := false
    else if signalName == "Tâ†“3"
        isSignal := tp_upperWick3
        isBearishSignal := true
    else if signalName == "Tâ†“4"
        isSignal := tp_upperWick4
        isBearishSignal := true
    
    // S&P500 (S)
    else if signalName == "Sä¸Šé™½"
        isSignal := sp_spikeHighBull
        isBearishSignal := false
    else if signalName == "Sä¸Šé™°"
        isSignal := sp_spikeHighBear
        isBearishSignal := true
    else if signalName == "Sä¸‹é™½"
        isSignal := sp_spikeLowBull
        isBearishSignal := false
    else if signalName == "Sä¸‹é™°"
        isSignal := sp_spikeLowBear
        isBearishSignal := true
    else if signalName == "Sâ—"
        isSignal := sp_bearishEng
        isBearishSignal := true
    else if signalName == "Sâ—†"
        isSignal := sp_bearishHar
        isBearishSignal := true
    else if signalName == "Sâ–¼"
        isSignal := sp_wickAbove
        isBearishSignal := true
    else if signalName == "Sâ†“"
        isSignal := sp_upperWick
        isBearishSignal := true
    else if signalName == "Sâ—‹"
        isSignal := sp_bullishEng
        isBearishSignal := false
    else if signalName == "Sâ—‡"
        isSignal := sp_bullishHar
        isBearishSignal := false
    else if signalName == "Sâ–²"
        isSignal := sp_wickBelow
        isBearishSignal := false
    else if signalName == "Sâ†‘"
        isSignal := sp_lowerWick
        isBearishSignal := false
    else if signalName == "Sâ—†â—†"
        isSignal := sp_bbHar
        isBearishSignal := false
    else if signalName == "Sâ—‡â—‡"
        isSignal := sp_bbullHar
        isBearishSignal := true
    else if signalName == "Sâ—Ã—"
        isSignal := sp_bearEngRej
        isBearishSignal := false
    else if signalName == "Sâ—‹Ã—"
        isSignal := sp_bullEngRej
        isBearishSignal := true
    else if signalName == "Sâ†‘3"
        isSignal := sp_lowerWick3
        isBearishSignal := false
    else if signalName == "Sâ†‘4"
        isSignal := sp_lowerWick4
        isBearishSignal := false
    else if signalName == "Sâ†“3"
        isSignal := sp_upperWick3
        isBearishSignal := true
    else if signalName == "Sâ†“4"
        isSignal := sp_upperWick4
        isBearishSignal := true
    
    // NASDAQ (Q)
    else if signalName == "Qä¸Šé™½"
        isSignal := nq_spikeHighBull
        isBearishSignal := false
    else if signalName == "Qä¸Šé™°"
        isSignal := nq_spikeHighBear
        isBearishSignal := true
    else if signalName == "Qä¸‹é™½"
        isSignal := nq_spikeLowBull
        isBearishSignal := false
    else if signalName == "Qä¸‹é™°"
        isSignal := nq_spikeLowBear
        isBearishSignal := true
    else if signalName == "Qâ—"
        isSignal := nq_bearishEng
        isBearishSignal := true
    else if signalName == "Qâ—†"
        isSignal := nq_bearishHar
        isBearishSignal := true
    else if signalName == "Qâ–¼"
        isSignal := nq_wickAbove
        isBearishSignal := true
    else if signalName == "Qâ†“"
        isSignal := nq_upperWick
        isBearishSignal := true
    else if signalName == "Qâ—‹"
        isSignal := nq_bullishEng
        isBearishSignal := false
    else if signalName == "Qâ—‡"
        isSignal := nq_bullishHar
        isBearishSignal := false
    else if signalName == "Qâ–²"
        isSignal := nq_wickBelow
        isBearishSignal := false
    else if signalName == "Qâ†‘"
        isSignal := nq_lowerWick
        isBearishSignal := false
    else if signalName == "Qâ—†â—†"
        isSignal := nq_bbHar
        isBearishSignal := false
    else if signalName == "Qâ—‡â—‡"
        isSignal := nq_bbullHar
        isBearishSignal := true
    else if signalName == "Qâ—Ã—"
        isSignal := nq_bearEngRej
        isBearishSignal := false
    else if signalName == "Qâ—‹Ã—"
        isSignal := nq_bullEngRej
        isBearishSignal := true
    else if signalName == "Qâ†‘3"
        isSignal := nq_lowerWick3
        isBearishSignal := false
    else if signalName == "Qâ†‘4"
        isSignal := nq_lowerWick4
        isBearishSignal := false
    else if signalName == "Qâ†“3"
        isSignal := nq_upperWick3
        isBearishSignal := true
    else if signalName == "Qâ†“4"
        isSignal := nq_upperWick4
        isBearishSignal := true
    
    [isSignal, isBearishSignal]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ã‚¨ãƒ³ãƒˆãƒªãƒ¼&ã‚¤ã‚°ã‚¸ãƒƒãƒˆãƒ­ã‚¸ãƒƒã‚¯
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ—¥è¶³ã‚·ã‚°ãƒŠãƒ«æ¤œå‡ºï¼ˆæ¯ãƒãƒ¼ãƒã‚§ãƒƒã‚¯ - V1.1æ–¹å¼ï¼‰
[signalDetected, isBearish] = f_checkSignal(entrySignalType)

// ã‚·ã‚°ãƒŠãƒ«ç”¨ã®å¤‰æ•°
var bool signalFiredPrev = false
var bool signalIsBearishPrev = false
var float daily_high = na
var float daily_low = na
var float daily_open_saved = na
var float daily_close = na
var float daily_atr = na
var bool ma_filter_passed_saved = false

// æ—¥è¶³ã‚·ã‚°ãƒŠãƒ«ç™ºç”Ÿæ™‚ã®å‡¦ç†
if signalDetected
    // æ—¥è¶³ã®MAé–¢ä¿‚ãƒã‚§ãƒƒã‚¯ï¼ˆã‚·ã‚°ãƒŠãƒ«ãƒãƒ¼åˆ¤å®šã®å ´åˆï¼‰
    dailyOpen = request.security(syminfo.tickerid, "D", open[1], lookahead=barmerge.lookahead_off)
    dailyMa5 = request.security(syminfo.tickerid, "D", ta.sma(close, 5)[1], lookahead=barmerge.lookahead_off)
    dailyMa25 = request.security(syminfo.tickerid, "D", ta.sma(close, 25)[1], lookahead=barmerge.lookahead_off)
    maPattern = f_getMaPattern(dailyOpen, dailyMa5, dailyMa25)
    
    if maFilterTiming == "ã‚·ã‚°ãƒŠãƒ«ãƒãƒ¼"
        // ã‚·ã‚°ãƒŠãƒ«ãƒãƒ¼ã§åˆ¤å®š
        ma_filter_passed_saved := not useMaFilter or maPattern == maFilterPattern
    else
        // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒãƒ¼ã§åˆ¤å®šã™ã‚‹å ´åˆ
        ma_filter_passed_saved := true
    
    // MAé–¢ä¿‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é€šéã—ãŸå ´åˆã®ã¿ã‚·ã‚°ãƒŠãƒ«ã‚’è¨˜éŒ²
    if ma_filter_passed_saved
        signalFiredPrev := true
        signalIsBearishPrev := isBearish
        daily_high := request.security(syminfo.tickerid, "D", high[1], lookahead=barmerge.lookahead_off)
        daily_low := request.security(syminfo.tickerid, "D", low[1], lookahead=barmerge.lookahead_off)
        daily_open_saved := dailyOpen
        daily_close := request.security(syminfo.tickerid, "D", close[1], lookahead=barmerge.lookahead_off)
        daily_atr := request.security(syminfo.tickerid, "D", ta.atr(14)[1], lookahead=barmerge.lookahead_off)

// ã‚¨ãƒ³ãƒˆãƒªãƒ¼åˆ¤å®š
var int entry_date = na
var float entry_price = na
var int entry_daily_time = na

// ç¿Œãƒãƒ¼ã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼ˆV1.1æ–¹å¼ï¼‰
if signalFiredPrev and strategy.position_size == 0
    
    entryCondition = false
    maCheckPassed = true  // MAé–¢ä¿‚ãƒã‚§ãƒƒã‚¯é€šéãƒ•ãƒ©ã‚°
    
    // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒãƒ¼ã§MAé–¢ä¿‚ã‚’åˆ¤å®šã™ã‚‹å ´åˆ
    if maFilterTiming == "ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒãƒ¼" and useMaFilter
        // 1æ™‚é–“è¶³ã®å§‹å€¤ã¨MAã§åˆ¤å®š
        maPattern_entry = f_getMaPattern(open, ma5_1h, ma25_1h)
        if maPattern_entry != maFilterPattern
            maCheckPassed := false
            // MAé–¢ä¿‚ãŒåˆã‚ãªã„å ´åˆã¯æ¬¡ã®ãƒãƒ¼ã¸
    
    // MAé–¢ä¿‚ãŒå•é¡Œãªã„å ´åˆã®ã¿ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ–¹æ³•ã«ã‚ˆã‚‹åˆ¤å®šã¸é€²ã‚€
    if maCheckPassed
        
        if entryMethod == "æ¬¡ãƒãƒ¼å§‹å€¤"
            // æ¬¡ãƒãƒ¼å§‹å€¤ã§ã‚¨ãƒ³ãƒˆãƒªãƒ¼
            entryCondition := true
        
        else if entryMethod == "æŒ‡å€¤A"
            // é«˜å€¤ã¨å®Ÿä½“ä¸Šé™ã®ä¸­é–“ï¼ˆå£²ã‚Šï¼‰/ å®‰å€¤ã¨å®Ÿä½“ä¸‹é™ã®ä¸­é–“ï¼ˆè²·ã„ï¼‰
            if signalIsBearishPrev
                bodyTop = math.max(daily_open_saved, daily_close)
                limitPrice = (daily_high + bodyTop) / 2
                entryCondition := high >= limitPrice
            else
                bodyBottom = math.min(daily_open_saved, daily_close)
                limitPrice = (daily_low + bodyBottom) / 2
                entryCondition := low <= limitPrice
        
        else if entryMethod == "æŒ‡å€¤C"
            // ãƒ¬ãƒ³ã‚¸æ¯”ç‡
            dailyRange = daily_high - daily_low
            if signalIsBearishPrev
                limitPrice = daily_high - (dailyRange * rangePercent)
                entryCondition := high >= limitPrice
            else
                limitPrice = daily_low + (dailyRange * rangePercent)
                entryCondition := low <= limitPrice
        
        else if entryMethod == "æŒ‡å€¤E"
            // ATRæ¯”ç‡
            if signalIsBearishPrev
                limitPrice = daily_open_saved + (daily_atr * atrMultiplier)
                entryCondition := high >= limitPrice
            else
                limitPrice = daily_open_saved - (daily_atr * atrMultiplier)
                entryCondition := low <= limitPrice
        
        else if entryMethod == "ãƒ•ã‚£ãƒœãƒŠãƒƒãƒ"
            // ãƒ•ã‚£ãƒœãƒŠãƒƒãƒãƒªãƒˆãƒ¬ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒˆ
            fiboRange = daily_high - daily_low
            fibo382 = signalIsBearishPrev ? daily_low + (fiboRange * 0.382) : daily_high - (fiboRange * 0.382)
            fibo500 = signalIsBearishPrev ? daily_low + (fiboRange * 0.500) : daily_high - (fiboRange * 0.500)
            fibo618 = signalIsBearishPrev ? daily_low + (fiboRange * 0.618) : daily_high - (fiboRange * 0.618)
            
            targetFibo = fiboLevel == "38.2%" ? fibo382 : fiboLevel == "50%" ? fibo500 : fibo618
            
            if signalIsBearishPrev
                // å£²ã‚Š: ãƒªãƒˆãƒ¬ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒˆåˆ°é” + é™°ç·šç¢ºå®š
                entryCondition := high >= targetFibo and close < open
            else
                // è²·ã„: ãƒªãƒˆãƒ¬ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒˆåˆ°é” + é™½ç·šç¢ºå®š
                entryCondition := low <= targetFibo and close > open
        
        else if entryMethod == "MA1H"
            // 1æ™‚é–“è¶³MAã‚¿ãƒƒãƒ
            targetMA = maTypeForEntry == "5MA" ? ma5_1h : ma25_1h
            if signalIsBearishPrev
                entryCondition := high >= targetMA and close < open
            else
                entryCondition := low <= targetMA and close > open
        
        else if entryMethod == "MAD"
            // æ—¥è¶³MAã‚¿ãƒƒãƒ
            targetMA = maTypeForEntry == "5MA" ? ma5_daily : ma25_daily
            if signalIsBearishPrev
                entryCondition := high >= targetMA and close < open
            else
                entryCondition := low <= targetMA and close > open
    
    // ã‚¨ãƒ³ãƒˆãƒªãƒ¼å®Ÿè¡Œ
    if entryCondition
        if signalIsBearishPrev
            strategy.entry("Short", strategy.short, qty=1)
        else
            strategy.entry("Long", strategy.long, qty=1)
        
        entry_date := dayofmonth(time)
        entry_price := close
        // ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ™‚ã®æ—¥è¶³ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¨˜éŒ²
        daily_time_at_entry = request.security(syminfo.tickerid, "D", time, lookahead=barmerge.lookahead_off)
        entry_daily_time := int(daily_time_at_entry)
        signalFiredPrev := false

// æ±ºæ¸ˆãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ—¥è¶³ãƒ™ãƒ¼ã‚¹ - æ–°ãƒãƒ¼æ¤œå‡ºæ–¹å¼ï¼‰
if strategy.position_size != 0 and not na(entry_daily_time)
    // ç¾åœ¨ã®æ—¥è¶³ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å–å¾—
    current_daily_time_value = request.security(syminfo.tickerid, "D", time, lookahead=barmerge.lookahead_off)
    current_daily_time = int(current_daily_time_value)
    
    // æ—¥è¶³ã®æ–°ãƒãƒ¼æ¤œå‡º
    daily_time_changed_exit = ta.change(current_daily_time_value) != 0
    
    // ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ—¥ã‹ã‚‰ã®çµŒéæ—¥æ•°ã‚’è¨ˆç®—
    // 86400000 = 1æ—¥ã®ãƒŸãƒªç§’æ•°
    days_diff = math.round((current_daily_time - entry_daily_time) / 86400000)
    
    exitBarsDelay = exitType == "å½“æ—¥çµ‚å€¤" ? 0 : exitType == "ç¿Œæ—¥çµ‚å€¤" ? 1 : 2
    
    // æ—¥è¶³ã®æ–°ãƒãƒ¼ãŒå‡ºç¾ã—ã€è¦å®šã®æ—¥æ•°ãŒçµŒéã—ãŸã‚‰æ±ºæ¸ˆ
    if daily_time_changed_exit and days_diff >= exitBarsDelay
        if strategy.position_size > 0
            strategy.close("Long")
        else
            strategy.close("Short")
        entry_date := na
        entry_price := na
        entry_daily_time := na

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è¡¨ç¤º
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if showSignals and signalDetected and ma_filter_passed_saved
    maPatternText = ""
    if useMaFilter
        dailyOpen_display = request.security(syminfo.tickerid, "D", open[1], lookahead=barmerge.lookahead_off)
        dailyMa5_display = request.security(syminfo.tickerid, "D", ta.sma(close, 5)[1], lookahead=barmerge.lookahead_off)
        dailyMa25_display = request.security(syminfo.tickerid, "D", ta.sma(close, 25)[1], lookahead=barmerge.lookahead_off)
        maPattern_display = f_getMaPattern(dailyOpen_display, dailyMa5_display, dailyMa25_display)
        maPatternText := "\n" + maPattern_display
        if maFilterTiming == "ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒãƒ¼"
            maPatternText := maPatternText + "\n(æ¬¡ãƒãƒ¼ã§MAåˆ¤å®š)"
    
    label.new(bar_index, isBearish ? high : low, 
              entrySignalType + maPatternText, 
              style=isBearish ? label.style_label_down : label.style_label_up,
              color=isBearish ? color.new(color.red, 20) : color.new(color.green, 20),
              textcolor=color.white, size=size.small)

if showEntryExit and strategy.position_size != 0 and not na(entry_price)
    if bar_index == 0 or strategy.position_size[1] == 0
        label.new(bar_index, strategy.position_size > 0 ? low : high, 
                  "ğŸ“Entry\n" + str.tostring(entry_price, "#.#"),
                  style=strategy.position_size > 0 ? label.style_label_up : label.style_label_down,
                  color=strategy.position_size > 0 ? color.new(color.blue, 30) : color.new(color.orange, 30),
                  textcolor=color.white, size=size.small)

bgcolor(close > ma5_1h ? color.new(color.green, 95) : color.new(color.red, 95), title="5MA(1H)ã¨ã®ä½ç½®")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¡¨ç¤º
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var table perfTable = table.new(position.bottom_right, 2, 8, border_width=1, border_color=color.gray)

if barstate.islast
    table.cell(perfTable, 0, 0, "é …ç›®", bgcolor=color.new(color.gray, 70), text_color=color.white, text_size=size.small)
    table.cell(perfTable, 1, 0, "å€¤", bgcolor=color.new(color.gray, 70), text_color=color.white, text_size=size.small)
    
    table.cell(perfTable, 0, 1, "ç´”åˆ©ç›Š", text_color=color.white, text_size=size.small)
    table.cell(perfTable, 1, 1, str.tostring(strategy.netprofit, "#,###"), 
               text_color=strategy.netprofit > 0 ? color.lime : color.red, text_size=size.small)
    
    table.cell(perfTable, 0, 2, "ç·å–å¼•æ•°", text_color=color.white, text_size=size.small)
    table.cell(perfTable, 1, 2, str.tostring(strategy.closedtrades), text_color=color.white, text_size=size.small)
    
    winRate = strategy.closedtrades > 0 ? strategy.wintrades / strategy.closedtrades * 100 : 0
    table.cell(perfTable, 0, 3, "å‹ç‡", text_color=color.white, text_size=size.small)
    table.cell(perfTable, 1, 3, str.tostring(winRate, "#.#") + "%", text_color=color.white, text_size=size.small)
    
    table.cell(perfTable, 0, 4, "PF", text_color=color.white, text_size=size.small)
    pf = strategy.grossloss != 0 ? math.abs(strategy.grossprofit / strategy.grossloss) : 0
    table.cell(perfTable, 1, 4, str.tostring(pf, "#.##"), text_color=color.white, text_size=size.small)
    
    table.cell(perfTable, 0, 5, "æœ€å¤§DD", text_color=color.white, text_size=size.small)
    table.cell(perfTable, 1, 5, str.tostring(strategy.max_drawdown, "#,###"), text_color=color.red, text_size=size.small)
    
    table.cell(perfTable, 0, 6, "å¹³å‡åˆ©ç›Š", text_color=color.white, text_size=size.small)
    avgWin = strategy.wintrades > 0 ? strategy.grossprofit / strategy.wintrades : 0
    table.cell(perfTable, 1, 6, str.tostring(avgWin, "#,###"), text_color=color.lime, text_size=size.small)
    
    table.cell(perfTable, 0, 7, "å¹³å‡æå¤±", text_color=color.white, text_size=size.small)
    avgLoss = strategy.losstrades > 0 ? strategy.grossloss / strategy.losstrades : 0
    table.cell(perfTable, 1, 7, str.tostring(avgLoss, "#,###"), text_color=color.red, text_size=size.small)
